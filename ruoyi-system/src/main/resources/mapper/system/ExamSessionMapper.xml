<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.system.mapper.ExamSessionMapper">

	<resultMap type="ExamSession" id="ExamSessionResult">
		<id     property="sessionId"         column="session_id"         />
		<result property="subjectId"         column="subject_id"         />
		<result property="subjectName"       column="subject_name"       />
		<result property="siteId"            column="site_id"            />
		<result property="siteName"          column="site_name"          />
		<result property="sessionName"       column="session_name"       />
		<result property="sessionCode"       column="session_code"       />
		<result property="examDate"          column="exam_date"          />
		<result property="startTime"         column="start_time"         />
		<result property="endTime"           column="end_time"           />
		<result property="maxCandidates"     column="max_candidates"     />
		<result property="currentCandidates" column="current_candidates" />
		<result property="status"            column="status"             />
		<result property="sortOrder"         column="sort_order"         />
		<result property="createBy"          column="create_by"          />
		<result property="createTime"        column="create_time"        />
		<result property="updateBy"          column="update_by"          />
		<result property="updateTime"        column="update_time"        />
		<result property="remark"            column="remark"             />
	</resultMap>
	
	<sql id="selectExamSessionVo">
        select s.session_id, s.subject_id, s.site_id, s.session_name, s.session_code, 
               s.exam_date, s.start_time, s.end_time, s.max_candidates, s.current_candidates,
               s.status, s.sort_order, s.create_by, s.create_time, s.update_by, s.update_time, s.remark,
               sub.subject_name, site.site_name
		from exam_session s
		left join exam_subject sub on s.subject_id = sub.subject_id
		left join exam_site site on s.site_id = site.site_id
    </sql>
	
	<select id="selectExamSessionList" parameterType="ExamSession" resultMap="ExamSessionResult">
	    <include refid="selectExamSessionVo"/>
		<where>
			<if test="sessionName != null and sessionName != ''">
				AND s.session_name like concat('%', #{sessionName}, '%')
			</if>
			<if test="sessionCode != null and sessionCode != ''">
				AND s.session_code like concat('%', #{sessionCode}, '%')
			</if>
			<if test="subjectId != null">
				AND s.subject_id = #{subjectId}
			</if>
			<if test="siteId != null">
				AND s.site_id = #{siteId}
			</if>
			<if test="examDate != null">
				AND date_format(s.exam_date,'%Y-%m-%d') = date_format(#{examDate},'%Y-%m-%d')
			</if>
			<if test="status != null and status != ''">
				AND s.status = #{status}
			</if>
		</where>
		order by s.exam_date desc, s.start_time, s.sort_order
	</select>
	
	<select id="selectExamSessionById" parameterType="Long" resultMap="ExamSessionResult">
		<include refid="selectExamSessionVo"/>
		where s.session_id = #{sessionId}
	</select>
	
	<select id="checkSessionCodeUnique" parameterType="String" resultMap="ExamSessionResult">
		select session_id, session_code from exam_session
		where session_code = #{sessionCode} limit 1
	</select>
	
	<insert id="insertExamSession" parameterType="ExamSession" useGeneratedKeys="true" keyProperty="sessionId">
 		insert into exam_session(
 			<if test="subjectId != null">subject_id,</if>
 			<if test="siteId != null">site_id,</if>
 			<if test="sessionName != null and sessionName != ''">session_name,</if>
 			<if test="sessionCode != null and sessionCode != ''">session_code,</if>
 			<if test="examDate != null">exam_date,</if>
 			<if test="startTime != null">start_time,</if>
 			<if test="endTime != null">end_time,</if>
 			<if test="maxCandidates != null">max_candidates,</if>
 			<if test="currentCandidates != null">current_candidates,</if>
 			<if test="status != null and status != ''">status,</if>
 			<if test="sortOrder != null">sort_order,</if>
 			<if test="remark != null and remark != ''">remark,</if>
 			<if test="createBy != null and createBy != ''">create_by,</if>
 			create_time
 		)values(
 			<if test="subjectId != null">#{subjectId},</if>
 			<if test="siteId != null">#{siteId},</if>
 			<if test="sessionName != null and sessionName != ''">#{sessionName},</if>
 			<if test="sessionCode != null and sessionCode != ''">#{sessionCode},</if>
 			<if test="examDate != null">#{examDate},</if>
 			<if test="startTime != null">#{startTime},</if>
 			<if test="endTime != null">#{endTime},</if>
 			<if test="maxCandidates != null">#{maxCandidates},</if>
 			<if test="currentCandidates != null">#{currentCandidates},</if>
 			<if test="status != null and status != ''">#{status},</if>
 			<if test="sortOrder != null">#{sortOrder},</if>
 			<if test="remark != null and remark != ''">#{remark},</if>
 			<if test="createBy != null and createBy != ''">#{createBy},</if>
 			sysdate()
 		)
	</insert>
	
	<update id="updateExamSession" parameterType="ExamSession">
 		update exam_session
 		<set>
 			<if test="subjectId != null">subject_id = #{subjectId},</if>
 			<if test="siteId != null">site_id = #{siteId},</if>
 			<if test="sessionName != null and sessionName != ''">session_name = #{sessionName},</if>
 			<if test="sessionCode != null and sessionCode != ''">session_code = #{sessionCode},</if>
 			<if test="examDate != null">exam_date = #{examDate},</if>
 			<if test="startTime != null">start_time = #{startTime},</if>
 			<if test="endTime != null">end_time = #{endTime},</if>
 			<if test="maxCandidates != null">max_candidates = #{maxCandidates},</if>
 			<if test="currentCandidates != null">current_candidates = #{currentCandidates},</if>
 			<if test="status != null and status != ''">status = #{status},</if>
 			<if test="sortOrder != null">sort_order = #{sortOrder},</if>
 			<if test="remark != null">remark = #{remark},</if>
 			<if test="updateBy != null and updateBy != ''">update_by = #{updateBy},</if>
 			update_time = sysdate()
 		</set>
 		where session_id = #{sessionId}
	</update>
	
	<delete id="deleteExamSessionById" parameterType="Long">
		delete from exam_session where session_id = #{sessionId}
	</delete>
	
	<delete id="deleteExamSessionByIds" parameterType="Long">
 		delete from exam_session where session_id in
 		<foreach collection="array" item="sessionId" open="(" separator="," close=")">
 			#{sessionId}
        </foreach> 
 	</delete>

</mapper>
